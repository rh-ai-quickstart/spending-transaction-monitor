# Default values for spending-monitor
global:
  imageRegistry: quay.io
  imageRepository: rh-ai-quickstart
  imageTag: latest
  imagePullPolicy: Always
  storageClass: ""
  models:
    remote-llm:
      id: custom-model-id
      url: https://custom-server-url/v1
      apiToken: fake-token
      enabled: false
  
  # Security settings for Bitnami charts
  security:
    allowInsecureImages: true  # Allow Bitnami images from quay.io

# LLM Service Configuration
# Enable/disable LLM service providers
llm-service:
  enabled: false  # vLLM-based model serving (for larger models like 70B)

llama-stack:
  enabled: true  # Meta's Llama Stack distribution (for smaller models like 1B-3B)
  pgvector:
    enabled: false
  # Set to true if using LLM_PROVIDER=llamastack

# Secrets configuration - these values should be overridden with actual secrets
secrets:
  # Database secrets
  POSTGRES_DB: "spending-monitor"
  POSTGRES_USER: "user"
  POSTGRES_PASSWORD: "changeme"

  # API secrets
  DATABASE_URL: "postgresql+asyncpg://user:changeme@spending-monitor-db:5432/spending-monitor"
  API_KEY: "changeme"
  BASE_URL: "http://localhost:8000"
  LLM_PROVIDER: "llamastack"  # Options: "openai", "vertexai", "llamastack"
  MODEL: "llama-3-3-70b-instruct-w8a8"  # Model name (varies by provider)
  ENVIRONMENT: "production"
  DEBUG: "false"
  BYPASS_AUTH: "false"
  CORS_ALLOWED_ORIGINS: '["*"]'
  ALLOWED_ORIGINS: '["*"]'
  ALLOWED_HOSTS: '["*"]'
  SMTP_HOST: "changeme"
  SMTP_PORT: "587"
  SMTP_FROM_EMAIL: "changeme"
  SMTP_USE_TLS: "true"
  SMTP_USE_SSL: "false"
  LLAMASTACK_BASE_URL: "http://localhost:8321"  # Remote LlamaStack URL (e.g., "https://llamastack.example.com:8321")

  
  # Keycloak configuration
  # Internal Keycloak URL (for API to reach Keycloak via cluster network)
  KEYCLOAK_URL: "http://spending-monitor-keycloak:8080"
  # External Keycloak URL (for browser access and token issuer)
  KEYCLOAK_FRONTEND_URL: "https://spending-monitor-keycloak-your-namespace.apps.your-cluster.example.com"
  KEYCLOAK_REALM: "spending-monitor"
  KEYCLOAK_CLIENT_ID: "spending-monitor"

  # UI environment variables (Note: VITE_KEYCLOAK_* are mapped from KEYCLOAK_* in templates)

# Database configuration
database:
  enabled: true
  name: spending-monitor-db
  image:
    repository: quay.io/sclorg/postgresql-16-c9s
    tag: latest
  service:
    type: ClusterIP
    port: 5432
  persistence:
    enabled: true
    size: 10Gi
    accessMode: ReadWriteOnce
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Database migration configuration
migration:
  enabled: true
  name: spending-monitor-migration
  image:
    repository: spending-monitor-db
    tag: latest
  restartPolicy: Never
  backoffLimit: 1  # Only retry once - if it fails, it's likely a config issue
  resources:
    requests:
      memory: "1Gi"
      cpu: "250m"
    limits:
      memory: "2Gi"  # Increased from 1Gi to accommodate torch/sentence-transformers
      cpu: "1000m"

# API configuration
api:
  enabled: true
  name: spending-monitor-api
  image:
    repository: spending-monitor-api
    tag: latest
  service:
    type: ClusterIP
    port: 8000
  replicas: 1
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  healthCheck:
    enabled: true
    path: /health
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 3

# UI configuration
ui:
  enabled: true
  name: spending-monitor-ui
  image:
    repository: spending-monitor-ui
    tag: latest
  service:
    type: ClusterIP
    port: 8080
  replicas: 1
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"
  healthCheck:
    enabled: true
    path: /
    initialDelaySeconds: 10
    periodSeconds: 10

# Nginx reverse proxy configuration
# NOTE: When deploying on OpenShift, it's recommended to disable nginx
# and use native OpenShift Routes for path-based routing instead.
# Set enabled: false to use the 2-route approach (UI + API routes)
nginx:
  enabled: false
  name: spending-monitor-nginx
  image:
    repository: nginx
    tag: "1.25-alpine"
  service:
    type: ClusterIP
    port: 8080
  replicas: 1
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "200m"
  healthCheck:
    enabled: true
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 10

# OpenShift Routes configuration (preferred over Ingress)
routes:
  enabled: true
  annotations: {}
  # Shared hostname for all routes (REQUIRED for nginx.enabled=false)
  # IMPORTANT: All routes must use the same hostname for path-based routing
  # Format: spending-monitor-<namespace>.apps.<cluster-domain>
  # Example: spending-monitor-my-namespace.apps.my-cluster.com
  sharedHost: ""  # Set custom hostname or leave empty (will use ui.host fallback)
  # nginx route configuration (when nginx.enabled=true)
  nginx:
    host: ""  # Leave empty to auto-generate hostname
    tls:
      enabled: true
      termination: edge
      insecureEdgeTerminationPolicy: Redirect
  # Direct routes configuration (when nginx.enabled=false)
  # NOTE: When using direct routes, set routes.sharedHost for all routes
  ui:
    host: ""  # Used as fallback if sharedHost is empty
    tls:
      enabled: true
      termination: edge
      insecureEdgeTerminationPolicy: Redirect
  api:
    host: ""  # Ignored - uses sharedHost or ui.host
    tls:
      enabled: true
      termination: edge
      insecureEdgeTerminationPolicy: Redirect

# ServiceAccount
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod Security Context
podSecurityContext: {}

# Security Context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Keycloak configuration (subchart)
# This references the keycloak subchart in deploy/helm/keycloak
# Keycloak now uses its own dedicated pgvector PostgreSQL instance
keycloak:
  enabled: true
  
  # Admin configuration
  # Password comes from environment variables passed via Makefile
  admin:
    username: admin
    # Password will be passed via --set flag from Makefile
  
  # Database configuration
  database:
    vendor: postgres
  
  # pgvector PostgreSQL configuration
  # This deploys a dedicated PostgreSQL instance for Keycloak
  # All database connection details are configured here
  # pgvector:
  #   enabled: true
  #   secret:
  #     host: pgvector  # Database host (for external DB, set to external hostname)
  #     port: "5432"  # Database port
  #     user: keycloak  # Database username
  #     password: keycloak  # Will be overridden by KEYCLOAK_DB_PASSWORD from Makefile
  #     dbname: keycloak  # Database name
  
  # Configuration
  config:
    proxy: edge
    proxyHeaders: xforwarded
    production: true
    healthEnabled: true
    metricsEnabled: true
    hostnameStrict: false
  
  # Route for OpenShift
  route:
    enabled: true
  
  # For additional customization, see: deploy/helm/keycloak/values.yaml
  # You can override any value from the keycloak chart here
