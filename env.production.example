# Spending Transaction Monitor - Production Environment Configuration
# Copy this file to .env.production and update the values for production deployment

# =============================================================================
# Database Configuration
# =============================================================================
POSTGRES_DB=spending-monitor
POSTGRES_USER=user
POSTGRES_PASSWORD=password
DB_PORT=5432
DATABASE_URL=postgresql+asyncpg://user:password@postgres:5432/spending-monitor

# =============================================================================
# API Configuration
# =============================================================================
API_PORT=8000
ENVIRONMENT=production
BYPASS_AUTH=false
DEBUG=false

# =============================================================================
# CORS Configuration
# =============================================================================
# Update these with your actual production URLs
CORS_ALLOWED_ORIGINS=https://spending-monitor-your-namespace.apps.your-cluster.example.com
ALLOWED_ORIGINS=https://spending-monitor-your-namespace.apps.your-cluster.example.com
ALLOWED_HOSTS='["https://spending-monitor-your-namespace.apps.your-cluster.example.com"]'

# =============================================================================
# LLM Configuration (Required for AI features)
# =============================================================================
LLM_PROVIDER=openai
BASE_URL=https://api.openai.com/v1
API_KEY=your-production-openai-api-key-here
MODEL=gpt-4
NODE_ENV=production

# =============================================================================
# Embedding Configuration (for category normalization)
# =============================================================================
EMBEDDING_PROVIDER=local
EMBEDDING_MODEL=all-minilm
EMBEDDING_DIMENSIONS=384

# =============================================================================
# Keycloak Authentication Configuration (OpenShift/Production)
# =============================================================================
# KEYCLOAK_URL: Internal URL for API to reach Keycloak (via cluster network)
# - Used by API for JWKS, userinfo, and other internal endpoints
# - Uses Kubernetes service name for fast internal communication
# - Format: http://SERVICE-NAME:PORT or https://SERVICE-NAME:PORT
KEYCLOAK_URL=http://spending-monitor-keycloak:8080

# KEYCLOAK_FRONTEND_URL: External URL where browser accesses Keycloak
# - Used for token issuer validation, authorization, and browser redirects
# - Must match the public route/URL the browser uses to access Keycloak
# - Tokens are issued with this URL as the issuer
# - Format: https://KEYCLOAK-ROUTE.apps.YOUR-CLUSTER.example.com
# - This is dynamically generated in Makefile as: https://PROJECT_NAME-keycloak-NAMESPACE.CLUSTER_DOMAIN
KEYCLOAK_FRONTEND_URL=https://spending-monitor-keycloak-your-namespace.apps.your-cluster.example.com

KEYCLOAK_REALM=spending-monitor
KEYCLOAK_CLIENT_ID=spending-monitor

# Keycloak Admin Configuration
# KEYCLOAK_ADMIN and KEYCLOAK_ADMIN_PASSWORD are Keycloak's native admin variables used by:
#   1. Setup scripts (for realm/user configuration)
#   2. Helm deployment (for production Keycloak instance)
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=change-me-in-production
KEYCLOAK_DEFAULT_PASSWORD=change-me-in-production

# Keycloak Client Configuration
# Note: These should match your production UI URL
# These are dynamically generated in Makefile as: https://PROJECT_NAME-NAMESPACE.CLUSTER_DOMAIN
KEYCLOAK_REDIRECT_URIS=https://spending-monitor-your-namespace.apps.your-cluster.example.com/*,https://spending-monitor-your-namespace.apps.your-cluster.example.com
KEYCLOAK_WEB_ORIGINS=https://spending-monitor-your-namespace.apps.your-cluster.example.com

# Keycloak Database Configuration
KEYCLOAK_DB_USER=keycloak
KEYCLOAK_DB_PASSWORD=change-me-in-production

# =============================================================================
# SMTP Configuration (for email notifications)
# =============================================================================
# Configure with your production SMTP server
SMTP_HOST=smtp.your-mail-server.com
SMTP_PORT=587
SMTP_USERNAME=your-smtp-username
SMTP_PASSWORD=your-smtp-password
SMTP_FROM_EMAIL=noreply@your-domain.com
SMTP_USE_TLS=true
SMTP_USE_SSL=false

# =============================================================================
# UI Configuration
# =============================================================================
VITE_API_BASE_URL=/api
VITE_BYPASS_AUTH=false
VITE_ENVIRONMENT=production
# Note: VITE_KEYCLOAK_URL is set from KEYCLOAK_FRONTEND_URL in deployment

# =============================================================================
# LlamaStack Configuration (Optional - for LLM)
# =============================================================================
LLAMASTACK_BASE_URL=http://llamastack:8321
LLAMASTACK_MODEL=meta-llama/Llama-3.1-8B-Instruct

# =============================================================================
# Production Deployment Notes
# =============================================================================
# Two-URL Keycloak Setup for OpenShift/Kubernetes:
# 
# KEYCLOAK_URL (Internal - Cluster Network):
#   - Used by API pods to reach Keycloak service
#   - Uses Kubernetes service DNS (fast, no ingress overhead)
#   - Format: http://spending-monitor-keycloak:8080
#   - OR for external Keycloak: https://external-keycloak.example.com
#
# KEYCLOAK_FRONTEND_URL (External - Public Route):
#   - Used by browser to access Keycloak
#   - Used for token issuer validation
#   - Must match the public OpenShift route
#   - Format: https://spending-monitor-keycloak-NAMESPACE.apps.CLUSTER.example.com
#
# Dynamic URL Generation:
# The Makefile automatically generates these URLs based on:
#   - PROJECT_NAME (default: spending-monitor)
#   - NAMESPACE (your OpenShift project)
#   - CLUSTER_DOMAIN (your cluster's domain)
#
# Example for cluster "apps.ai-dev04.kni.syseng.devcluster.openshift.com":
#   KEYCLOAK_FRONTEND_URL=https://spending-monitor-keycloak-spending-transaction-monitor.apps.ai-dev04.kni.syseng.devcluster.openshift.com
#   KEYCLOAK_REDIRECT_URIS=https://spending-monitor-spending-transaction-monitor.apps.ai-dev04.kni.syseng.devcluster.openshift.com/*
#
# This separation allows:
# ✅ Fast internal API communication via cluster network
# ✅ Browser access via public routes
# ✅ Consistent token issuer validation
# ✅ No DNS or networking hacks required
# ✅ Proper SSL/TLS termination at the route level

