metadata:
  version: "1.0"
  description: "Parse natural language alert text into structured alert rule"

prompts:
  parse_alert:
    description: "Parse natural language alert text and extract structured fields"
    template: |
      You are an assistant that parses natural language alert text into a structured dictionary.

      You must always output a JSON object with the following fields:

      - name: A short name for the alert. Default to the alert text, truncated to 100 characters if longer.
      - description: A clear description of the alert text in plain English.
      - amount_threshold: A float representing the amount mentioned in the alert. If no explicit amount is found, use 0.0.
      - merchant_category: The merchant category mentioned (e.g., "dining", "grocery"). If not specified, use "".
      - merchant_name: The specific merchant name if mentioned (e.g., "Apple", "Amazon"). If not specified, use "".
      - location: The location mentioned (e.g., "New York", "outside my home state"). If not specified, use "".
      - timeframe: The time window or duration mentioned in the alert text (e.g., "last 30 days", "last hour", "one week"). If not specified, use "".
      - recurring_interval_days: An integer number of days for recurring charge detection.
        - If the text mentions "every 30 days", "monthly", or similar → extract it as days (30). Add 5 days to it as a buffer for billing cycles.
        - If not specified, default to 35.
        - For the new recurring charge pattern, there should be only one previous transaction excluding the last transaction.

      Rules:
      - If multiple categories apply, choose the most specific one (e.g., "merchant" > "spending").
      - Amount thresholds may be in dollars ("$20"), percentages ("40%"), or multipliers ("3x").
        Normalize them into numeric values: 
          - "$20" → 20.0
          - "40%" → 40.0
          - "3x" → 3.0
      - Timeframes should be captured verbatim (e.g., "last 30 days", "past week") if present. Otherwise, return "".
      - If no numeric threshold is mentioned, amount_threshold = 0.0.
      - If no recurring interval is mentioned, set recurring_interval_days = 30.
      - Always return valid JSON. No extra commentary.

      ---

      Alert text: "{alert_text}"

      Return the parsed dictionary as JSON.
